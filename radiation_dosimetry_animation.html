<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Radiation Dosimetry Concepts - Interactive Animation</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }

        h1 {
            color: white;
            margin: 20px 0;
            text-align: center;
            font-size: 2em;
        }

        .container {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            max-width: 1400px;
            width: 100%;
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        button {
            padding: 12px 30px;
            font-size: 16px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        button.primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        button.primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }

        button.secondary {
            background: #f0f0f0;
            color: #333;
        }

        button.secondary:hover {
            background: #e0e0e0;
        }

        #canvas {
            width: 100%;
            height: 700px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            background: #fafafa;
        }

        .legend {
            margin-top: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .legend-box {
            width: 40px;
            height: 30px;
            border-radius: 5px;
            border: 2px solid #333;
        }

        .info-panel {
            margin-top: 20px;
            padding: 20px;
            background: #e3f2fd;
            border-radius: 10px;
            border-left: 4px solid #2196F3;
        }

        .info-panel h3 {
            color: #1976D2;
            margin-bottom: 10px;
        }

        .info-panel p {
            color: #333;
            line-height: 1.6;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }

        .particle {
            position: absolute;
            width: 8px;
            height: 8px;
            background: #ff6b6b;
            border-radius: 50%;
            animation: pulse 1s infinite;
        }
    </style>
</head>
<body>
    <h1>Radiation Dosimetry: Dose Concepts & Relationships</h1>

    <div class="container">
        <div class="controls">
            <button class="primary" onclick="startAnimation()">Start Animation</button>
            <button class="secondary" onclick="resetAnimation()">Reset</button>
            <button class="secondary" onclick="toggleLabels()">Toggle Language (DE/EN)</button>
            <button class="secondary" onclick="showNextStep()">Next Step</button>
        </div>

        <canvas id="canvas"></canvas>

        <div class="legend">
            <div class="legend-item">
                <div class="legend-box" style="background: #ffcccc;"></div>
                <span><strong>Energiedosis / Absorbed Dose (D)</strong> - Energy deposited per mass</span>
            </div>
            <div class="legend-item">
                <div class="legend-box" style="background: #cce5ff;"></div>
                <span><strong>Äquivalentdosis / Equivalent Dose (H)</strong> - D × Quality/Radiation Factor</span>
            </div>
            <div class="legend-item">
                <div class="legend-box" style="background: #d4edda;"></div>
                <span><strong>Effektive Dosis / Effective Dose (E)</strong> - Risk-weighted dose</span>
            </div>
            <div class="legend-item">
                <div class="legend-box" style="background: #fff3cd;"></div>
                <span><strong>Messgrößen / Operational Quantities</strong> - Measurable estimates</span>
            </div>
        </div>

        <div class="info-panel" id="infoPanel">
            <h3>Welcome to Radiation Dosimetry</h3>
            <p>Click "Start Animation" to see how different dose concepts relate to each other. The animation shows the flow from basic absorbed dose to complex risk assessments.</p>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        let animationStep = 0;
        let isAnimating = false;
        let useGerman = true;
        let currentFrame = 0;

        // Set canvas size
        function resizeCanvas() {
            canvas.width = canvas.offsetWidth;
            canvas.height = canvas.offsetHeight;
        }
        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);

        // Box definitions
        const boxes = {
            energyDose: {
                x: 100, y: 50, width: 200, height: 80,
                color: '#ffcccc',
                labelDE: 'Energiedosis D_T,R',
                labelEN: 'Absorbed Dose D_T,R',
                subDE: 'gemittelt über Organ T',
                subEN: 'averaged over organ T'
            },
            qFactor: {
                x: 350, y: 80, width: 140, height: 60,
                color: '#ffe6cc',
                labelDE: 'Q_R (ICRU)',
                labelEN: 'Q_R (ICRU)',
                subDE: 'Qualitätsfaktor',
                subEN: 'Quality Factor'
            },
            wFactor: {
                x: 350, y: 160, width: 140, height: 60,
                color: '#ffe6cc',
                labelDE: 'w_R (ICRP)',
                labelEN: 'w_R (ICRP)',
                subDE: 'Strahlungs-Wichtungsfaktor',
                subEN: 'Radiation Weighting Factor'
            },
            organEquiv: {
                x: 550, y: 50, width: 200, height: 80,
                color: '#cce5ff',
                labelDE: 'Organ-Äquivalentdosis H_T',
                labelEN: 'Organ Equivalent Dose H_T',
                subDE: 'H_T = Σ w_R × D_T,R',
                subEN: 'H_T = Σ w_R × D_T,R'
            },
            tissueFactor: {
                x: 800, y: 80, width: 140, height: 60,
                color: '#e6f2ff',
                labelDE: 'w_T',
                labelEN: 'w_T',
                subDE: 'Gewebe-Wichtungsfaktor',
                subEN: 'Tissue Weighting Factor'
            },
            effectiveDose: {
                x: 1000, y: 50, width: 200, height: 80,
                color: '#d4edda',
                labelDE: 'Effektive Dosis E',
                labelEN: 'Effective Dose E',
                subDE: 'E = Σ w_T × H_T',
                subEN: 'E = Σ w_T × H_T'
            },
            ambientDose: {
                x: 100, y: 250, width: 220, height: 80,
                color: '#fff3cd',
                labelDE: 'Umgebungs-Äquivalentdosis',
                labelEN: 'Ambient Dose Equivalent',
                subDE: 'H*(10)',
                subEN: 'H*(10)'
            },
            personalDoseDeep: {
                x: 400, y: 250, width: 220, height: 80,
                color: '#fff3cd',
                labelDE: 'Tiefen-Personendosis',
                labelEN: 'Personal Dose Equiv. (deep)',
                subDE: 'H_p(10)',
                subEN: 'H_p(10)'
            },
            personalDoseSurface: {
                x: 700, y: 250, width: 220, height: 80,
                color: '#fff3cd',
                labelDE: 'Oberflächen-Personendosis',
                labelEN: 'Personal Dose Equiv. (surface)',
                subDE: 'H_p(0.07)',
                subEN: 'H_p(0.07)'
            },
            measurementLabel: {
                x: 100, y: 200, width: 820, height: 30,
                color: '#ffeaa7',
                labelDE: 'Dosismessgrößen (Operational Quantities)',
                labelEN: 'Dose Measurement Quantities (Operational Quantities)',
                subDE: '',
                subEN: ''
            },
            bodyDoseLabel: {
                x: 550, y: 0, width: 650, height: 30,
                color: '#dfe6e9',
                labelDE: 'Körperdosen (Body Doses)',
                labelEN: 'Body Doses',
                subDE: '',
                subEN: ''
            }
        };

        // Arrows
        const arrows = [
            { from: 'energyDose', to: 'organEquiv', label: '×w_R', labelY: -10 },
            { from: 'organEquiv', to: 'effectiveDose', label: '×w_T', labelY: -10 },
            { from: 'ambientDose', to: 'effectiveDose', label: 'Abschätzung / Estimation', labelY: 40, dashed: true },
            { from: 'personalDoseDeep', to: 'effectiveDose', label: 'Abschätzung / Estimation', labelY: 30, dashed: true },
        ];

        function drawBox(box, highlight = false) {
            ctx.save();

            // Shadow
            if (highlight) {
                ctx.shadowColor = 'rgba(0, 0, 0, 0.3)';
                ctx.shadowBlur = 15;
                ctx.shadowOffsetX = 0;
                ctx.shadowOffsetY = 5;
            }

            // Box
            ctx.fillStyle = box.color;
            ctx.strokeStyle = highlight ? '#333' : '#666';
            ctx.lineWidth = highlight ? 3 : 2;
            roundRect(ctx, box.x, box.y, box.width, box.height, 10);
            ctx.fill();
            ctx.stroke();

            ctx.restore();

            // Text
            ctx.fillStyle = '#000';
            ctx.font = 'bold 14px Arial';
            ctx.textAlign = 'center';

            const label = useGerman ? box.labelDE : box.labelEN;
            const sub = useGerman ? box.subDE : box.subEN;

            const centerX = box.x + box.width / 2;
            const centerY = box.y + box.height / 2;

            if (sub) {
                ctx.fillText(label, centerX, centerY - 8);
                ctx.font = '12px Arial';
                ctx.fillStyle = '#555';
                ctx.fillText(sub, centerX, centerY + 10);
            } else {
                ctx.fillText(label, centerX, centerY + 5);
            }
        }

        function drawArrow(from, to, label = '', dashed = false, labelY = 0, animated = false) {
            const fromBox = boxes[from];
            const toBox = boxes[to];

            let startX = fromBox.x + fromBox.width;
            let startY = fromBox.y + fromBox.height / 2;
            let endX = toBox.x;
            let endY = toBox.y + toBox.height / 2;

            // Special handling for vertical arrows
            if (from === 'ambientDose' || from === 'personalDoseDeep') {
                startY = fromBox.y;
                endY = toBox.y + toBox.height;
                startX = fromBox.x + fromBox.width / 2;
                endX = toBox.x + toBox.width / 2;
            }

            ctx.save();
            ctx.strokeStyle = animated ? '#ff6b6b' : '#666';
            ctx.lineWidth = animated ? 3 : 2;

            if (dashed) {
                ctx.setLineDash([10, 5]);
            }

            ctx.beginPath();
            ctx.moveTo(startX, startY);
            ctx.lineTo(endX, endY);
            ctx.stroke();

            // Arrowhead
            const angle = Math.atan2(endY - startY, endX - startX);
            const headLength = 15;

            ctx.beginPath();
            ctx.moveTo(endX, endY);
            ctx.lineTo(
                endX - headLength * Math.cos(angle - Math.PI / 6),
                endY - headLength * Math.sin(angle - Math.PI / 6)
            );
            ctx.lineTo(
                endX - headLength * Math.cos(angle + Math.PI / 6),
                endY - headLength * Math.sin(angle + Math.PI / 6)
            );
            ctx.closePath();
            ctx.fillStyle = animated ? '#ff6b6b' : '#666';
            ctx.fill();

            ctx.restore();

            // Label
            if (label) {
                const midX = (startX + endX) / 2;
                const midY = (startY + endY) / 2 + labelY;

                ctx.font = '12px Arial';
                ctx.fillStyle = '#333';
                ctx.textAlign = 'center';
                ctx.fillText(label, midX, midY);
            }
        }

        function roundRect(ctx, x, y, width, height, radius) {
            ctx.beginPath();
            ctx.moveTo(x + radius, y);
            ctx.lineTo(x + width - radius, y);
            ctx.arcTo(x + width, y, x + width, y + radius, radius);
            ctx.lineTo(x + width, y + height - radius);
            ctx.arcTo(x + width, y + height, x + width - radius, y + height, radius);
            ctx.lineTo(x + radius, y + height);
            ctx.arcTo(x, y + height, x, y + height - radius, radius);
            ctx.lineTo(x, y + radius);
            ctx.arcTo(x, y, x + radius, y, radius);
            ctx.closePath();
        }

        function drawParticle(x, y) {
            ctx.beginPath();
            ctx.arc(x, y, 5, 0, Math.PI * 2);
            ctx.fillStyle = '#ff6b6b';
            ctx.fill();
        }

        function updateInfoPanel(step) {
            const info = document.getElementById('infoPanel');
            const messages = [
                {
                    title: 'Step 1: Absorbed Dose (Energiedosis)',
                    text: 'Radiation deposits energy in tissue. The absorbed dose D measures the energy deposited per unit mass (Gy = J/kg). This is specific to radiation type R and organ T.'
                },
                {
                    title: 'Step 2: Radiation Weighting Factor (w_R)',
                    text: 'Different radiation types (alpha, beta, gamma, neutrons) have different biological effects. The radiation weighting factor w_R accounts for this. ICRU uses quality factor Q_R, ICRP uses w_R.'
                },
                {
                    title: 'Step 3: Organ Equivalent Dose (H_T)',
                    text: 'The equivalent dose H_T = Σ(w_R × D_T,R) combines doses from all radiation types, weighted by their biological effectiveness. Unit: Sievert (Sv).'
                },
                {
                    title: 'Step 4: Tissue Weighting Factor (w_T)',
                    text: 'Different organs have different radiation sensitivities. The tissue weighting factor w_T reflects the relative risk of each organ to radiation-induced cancer and hereditary effects.'
                },
                {
                    title: 'Step 5: Effective Dose (E)',
                    text: 'The effective dose E = Σ(w_T × H_T) represents the total radiation risk to the whole body. It allows comparison of different exposure patterns. Unit: Sievert (Sv).'
                },
                {
                    title: 'Step 6: Operational Quantities (Messgrößen)',
                    text: 'In practice, we measure operational quantities like ambient dose equivalent H*(10) and personal dose equivalents H_p(10) and H_p(0.07). These provide conservative estimates of effective dose.'
                },
                {
                    title: 'Complete Overview',
                    text: 'The dosimetry system connects measurable physical quantities (absorbed dose) through weighting factors to risk-related quantities (effective dose). Operational quantities bridge theory and practical radiation protection.'
                }
            ];

            if (step < messages.length) {
                info.innerHTML = `
                    <h3>${messages[step].title}</h3>
                    <p>${messages[step].text}</p>
                `;
            }
        }

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Draw labels
            drawBox(boxes.bodyDoseLabel);
            drawBox(boxes.measurementLabel);

            // Draw all boxes
            Object.keys(boxes).forEach(key => {
                if (key !== 'bodyDoseLabel' && key !== 'measurementLabel') {
                    const highlight = (animationStep === 1 && key === 'energyDose') ||
                                    (animationStep === 2 && (key === 'qFactor' || key === 'wFactor')) ||
                                    (animationStep === 3 && key === 'organEquiv') ||
                                    (animationStep === 4 && key === 'tissueFactor') ||
                                    (animationStep === 5 && key === 'effectiveDose') ||
                                    (animationStep === 6 && (key === 'ambientDose' || key === 'personalDoseDeep' || key === 'personalDoseSurface'));
                    drawBox(boxes[key], highlight);
                }
            });

            // Draw arrows based on animation step
            if (animationStep >= 2) {
                drawArrow('energyDose', 'organEquiv', '×w_R', false, -10, animationStep === 2);
            }
            if (animationStep >= 4) {
                drawArrow('organEquiv', 'effectiveDose', '×w_T', false, -10, animationStep === 4);
            }
            if (animationStep >= 6) {
                const labels = useGerman ? 'Abschätzung' : 'Estimation';
                drawArrow('ambientDose', 'effectiveDose', labels, true, 40, false);
                drawArrow('personalDoseDeep', 'effectiveDose', labels, true, 30, false);
            }

            // Animated particles
            if (animationStep === 2 || animationStep === 4) {
                const progress = (currentFrame % 60) / 60;
                let startBox, endBox;

                if (animationStep === 2) {
                    startBox = boxes.energyDose;
                    endBox = boxes.organEquiv;
                } else {
                    startBox = boxes.organEquiv;
                    endBox = boxes.effectiveDose;
                }

                const x = startBox.x + startBox.width + (endBox.x - startBox.x - startBox.width) * progress;
                const y = startBox.y + startBox.height / 2;
                drawParticle(x, y);
            }
        }

        function startAnimation() {
            isAnimating = true;
            animationStep = 0;
            updateInfoPanel(0);
            animateSteps();
        }

        function animateSteps() {
            if (!isAnimating) return;

            currentFrame++;
            draw();

            if (currentFrame % 90 === 0 && animationStep < 7) {
                animationStep++;
                updateInfoPanel(animationStep);
            }

            if (animationStep < 7) {
                requestAnimationFrame(animateSteps);
            } else {
                isAnimating = false;
            }
        }

        function showNextStep() {
            if (animationStep < 7) {
                animationStep++;
                updateInfoPanel(animationStep);
                draw();
            }
        }

        function resetAnimation() {
            isAnimating = false;
            animationStep = 0;
            currentFrame = 0;
            updateInfoPanel(0);
            draw();
        }

        function toggleLabels() {
            useGerman = !useGerman;
            draw();
        }

        // Initial draw
        draw();
    </script>
</body>
</html>
